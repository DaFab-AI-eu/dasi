# Weather forecasting example

This example mimics a weather forecasting workflow, with a "forecast" part
generating data for a fake ensemble forecast, and a "mean" part computing
per-timestep means of the forecast output.

## Building

The main dependencies are DASI and eckit library.

```
export CMAKE_PREFIX_PATH=/dir/to/bundle_dasi

cmake -S . -B ./build

cmake --build ./build
```

## Running

### Schema

> [!IMPORTANT]
> Set valid paths in the `dasi.yaml`.

```
schema: path/to/schema/file
catalogue: toc
store: file
spaces:
- handler: Default
roots:
- path: path/to/data/output1
- path: path/to/data/output2
```

### Forecast app

The `forecast` app generates the mock data in the DASI root path. The options
can be set to manipulate the metadata, see `forecast -h`. Example usage,

```
./build/forecast -c ./dasi.yaml -t 1320
```

### Mean app

The `mean` app retrieves the data (generated by forecast) and computes
ensemble means of a chosen timestep and store the results in DASI.

Example usage,

```
./build/mean -c ./dasi.yaml -t 1320 -s 2
```

here, `-t` is the forecast time, and `-s` is the step number.

For more info, see `mean -h`.

## Schema

The DASI schema used in this example:

```
[ type, version, date, time
    [ number?, step [ level, param ]]
]
```

- **type**: data type (`ensemble` for the forecast and `ens_mean` for the means)
- **version**: experiment version (4-character string, default: `0001`)
- **date**: forecast date (`YYYYMMDD` string, default: `current date`)
- **time**: forecast time (`HHMM` string, default: `current time`)
- **number**: ensemble member number [0..N-1] (only used for `type=ensemble`)
- **step**: time step number [1..N]
- **level**: vertical level number [0..N-1]
- **param**: physical variable [`p`, `t`, `u`, `v`]
